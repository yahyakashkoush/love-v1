# ๐ง ุญู ูุดุงูู ุงูุฑูุน (Upload Failures) - ุฎุทูุงุช ูุงููุฉ

## ุงููุดุงูู ุงูุซูุงุซ
```
โ Failed to upload song
โ Failed to upload cover
โ Failed to upload image
```

## ุงูุณุจุจ ุงูุฑุฆูุณู
**ุญููู ุงููุตูู (Policies) ูู Supabase Storage ูู ุชูุนููู ุจุดูู ุตุญูุญ**

---

## โ ุงูุญู - ุฎุทูุงุช ุงูุชุตุญูุญ

### ุงูุฎุทูุฉ 1๏ธโฃ ุฏุฎูู Supabase Dashboard
1. ุงุฐูุจ ุฅูู: https://supabase.com/dashboard
2. ุงุฎุชุฑ ูุดุฑูุนู: **lovev1**
3. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ: **Storage** (ุนูู ุงููุณุงุฑ)

### ุงูุฎุทูุฉ 2๏ธโฃ ุฅุถุงูุฉ Policy ููู Bucket "songs"
1. ุงููุฑ ุนูู folder **songs**
2. ุงููุฑ ุนูู **Policies** (ูู ุงูุฃุนูู)
3. ุงุฎุชุฑ **New Policy** ุฃู **Add Policy**
4. ุงุฎุชุฑ: **For full customization**

**ูู ุงููููุฐุฌุ ุฃุฏุฎู:**
```
Policy name: Allow song uploads
Policy target: ANY

SQL:
true
```

ุซู: **Save**

### ุงูุฎุทูุฉ 3๏ธโฃ ุฅุถุงูุฉ Policy ููู Bucket "covers"
ูุฑุฑ ููุณ ุงูุฎุทูุงุช ููู folder **covers**

### ุงูุฎุทูุฉ 4๏ธโฃ ุฅุถุงูุฉ Policy ููู Bucket "images"
ูุฑุฑ ููุณ ุงูุฎุทูุงุช ููู folder **images**

---

## ุฃู: ุงุณุชุฎุฏุงู SQL ูุจุงุดุฑุฉ (ุฃุณูู)

ูู Supabase SQL Editor:

```sql
-- Allow uploads to songs bucket
CREATE POLICY "Allow song uploads"
ON storage.objects
FOR INSERT
WITH CHECK (bucket_id = 'songs');

-- Allow uploads to covers bucket
CREATE POLICY "Allow cover uploads"
ON storage.objects
FOR INSERT
WITH CHECK (bucket_id = 'covers');

-- Allow uploads to images bucket
CREATE POLICY "Allow image uploads"
ON storage.objects
FOR INSERT
WITH CHECK (bucket_id = 'images');

-- Allow public read access
CREATE POLICY "Allow public read"
ON storage.objects
FOR SELECT
USING (true);
```

---

## ๐ฑ ุงูุชุญุฏูุซุงุช ุนูู ุงูููุฏ

### โ ุชู ุชุญุฏูุซ ุงููููุงุช ุงูุชุงููุฉ:

1. **src/app/api/upload/song/route.ts**
   - โ ุฃูุถู ูุนุงูุฌุฉ ููุฃุฎุทุงุก
   - โ ุชุญููู File ุฅูู Buffer
   - โ ุฅุฑุณุงู Content-Type ุตุญูุญ
   - โ ุฑุณุงุฆู ุฎุทุฃ ููุตูุฉ

2. **src/app/api/upload/cover/route.ts**
   - โ ุฃูุถู ูุนุงูุฌุฉ ููุฃุฎุทุงุก
   - โ ุชุญููู File ุฅูู Buffer
   - โ ุงูุชุญูู ูู ููุน ุงูููู
   - โ ุฑุณุงุฆู ุฎุทุฃ ููุตูุฉ

3. **src/app/api/upload/image/route.ts**
   - โ ุฃูุถู ูุนุงูุฌุฉ ููุฃุฎุทุงุก
   - โ ุชุญููู File ุฅูู Buffer
   - โ ุงูุชุญูู ูู ุญุฌู ุงูููู
   - โ ุฑุณุงุฆู ุฎุทุฃ ููุตูุฉ

4. **src/components/admin/tabs/MediaTab.tsx**
   - โ ุนุฑุถ ุฑุณุงุฆู ุงูุฎุทุฃ ุงููุนููุฉ
   - โ ุฃููููุงุช ูุฌุงุญ/ูุดู (โ/โ)
   - โ ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก

---

## ๐ ุฎุตุงุฆุต ุงููููุงุช ุงููุฏุนููุฉ

### ุตูุฑ (Images):
- โ JPEG, PNG, WebP, GIF
- โ ุงูุญุฏ ุงูุฃูุตู: 10MB
- โ ุชุญุฏูุซ ุชููุงุฆู ููู gallery

### ุฃุบุงูู (Songs):
- โ MP3, WAV, OGG
- โ ุงูุญุฏ ุงูุฃูุตู: 50MB
- โ ุชุญุฏูุซ ุชููุงุฆู ูุน ุงูุนููุงู

### ุบูุงู (Cover):
- โ JPEG, PNG, WebP, GIF
- โ ุงูุญุฏ ุงูุฃูุตู: 10MB
- โ ุชุญุฏูุซ ุชููุงุฆู ููุฃุบููุฉ

---

## ๐งช ุงุฎุชุจุงุฑ ุงูุฑูุน

ุจุนุฏ ุชุทุจูู ุงูุฎุทูุงุช ุฃุนูุงู:

1. โ ุงุฐูุจ ุฅูู Admin Dashboard: http://localhost:3000/admin/login
2. โ ุชุณุฌูู ุฏุฎูู: admin@example.com / admin123
3. โ ุงูุชูู ุฅูู **Media Tab**
4. โ ุญุงูู ุฑูุน ุตูุฑุฉ
5. โ ูุฌุจ ุฃู ุชุฑู: โ Image uploaded successfully!
6. โ ูุฑุฑ ููุฃุบููุฉ ูุงูุบูุงู

---

## ๐ ูู ุญุงูุฉ ุงุณุชูุฑุงุฑ ุงููุดุงูู

### ุฎุทุฃ: "Unauthorized - No token provided"
- **ุงูุณุจุจ**: ุงูุชููู ุบูุฑ ูุฑุณู
- **ุงูุญู**: ุชุญูู ูู ุฃู ูุฏูู ุชููู ุตุญูุญ

### ุฎุทุฃ: "Unauthorized - Invalid token"
- **ุงูุณุจุจ**: ุงูุชููู ููุชูู ุฃู ุฎุงุทุฆ
- **ุงูุญู**: ุณุฌูู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู

### ุฎุทุฃ: "File too large"
- **ุงูุณุจุจ**: ุงูููู ุฃูุจุฑ ูู ุงูุญุฏ ุงูุฃูุตู
- **ุงูุญู**: ุถุบุท ุงูููู ุฃู ุงุฎุชูุงุฑ ููู ุฃุตุบุฑ

### ุฎุทุฃ: "Upload failed: insufficient permissions"
- **ุงูุณุจุจ**: ุญููู Storage ูู ุชูุถุจุท
- **ุงูุญู**: ุงุชุจุน ุฎุทูุงุช Supabase ุฃุนูุงู

---

## ๐ ูุนูููุงุช ุงูุงุชุตุงู

### API Endpoints:
- `POST /api/upload/image` - ุฑูุน ุตูุฑุฉ
- `POST /api/upload/song` - ุฑูุน ุฃุบููุฉ
- `POST /api/upload/cover` - ุฑูุน ุบูุงู

### ุงููุชุทูุจุงุช:
- `Authorization: Bearer <TOKEN>` - ุฅูุฒุงูู
- `FormData` ูุน ุงูููู

### ุงูุงุณุชุฌุงุจุฉ ุงููุงุฌุญุฉ:
```json
{
  "url": "https://...",
  "path": "...",
  "message": "File uploaded successfully"
}
```

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุณุฑูุนุฉ

### ุฅุฐุง ูู ููุฌุญ ุดูุก:
1. ุชุญูู ูู ุงูุฅูุชุฑูุช โ
2. ุชุฃูุฏ ูู Supabase config โ
3. ุฃุถู Storage Policies โ
4. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ (Cmd+Shift+R) โ
5. ุณุฌูู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู โ
6. ุญุงูู ุงูุฑูุน ูุฌุฏุฏุงู โ

---

## โจ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
โ ูุนุงูุฌุฉ ูููุงุช ูุญุณููุฉ
โ ุงูุชุญูู ูู ุญุฌู ุงูููู
โ ุงูุชุญูู ูู ููุน ุงูููู
โ ุชุญููู ุขูู ููู File โ Buffer
โ ุชุณุฌูู ูู ุงููููุณูู
โ Content-Type ุตุญูุญ
โ Status UI ูุญุณูู

---

## ๐ ููุงุญุธุงุช ูููุฉ

- ุงูู Buckets ูุฌุจ ุฃู ุชููู ููุฌูุฏุฉ ูู Supabase
- ุงูู Policies ุชุญุชุงุฌ ุชูุนูู ูู Supabase
- ุนูุฏ ุงูุฑูุน ูููุฑุฉ ุงูุฃููู ูุฏ ูุณุชุบุฑู ููุชุงู ุฃุทูู
- ูุชู ุญูุธ ุงููููุงุช ุจุฑุงุจุท ุนุงู ุฏุงุฆู

---

**Status**: โ ุฌุงูุฒ ููุนูู
**ุงูุชุงุฑูุฎ**: 1 ููููุจุฑ 2025
